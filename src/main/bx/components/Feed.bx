/**
 * A BoxLang based component that can be called from either script or the templating language
 * <p>
 * Each component can have 3 annotations
 * - @BoxComponent : Marks the class as a Component and registers as the name of the class
 * - @BoxComponent( "name" ) : Marks and sets the alias to the component
 * - @AllowsBody( boolean ) : Does the component allow a body
 * - @RequiresBody( boolean ) : Does the component require a body
 * <p>
 * The runtime also injects the following helpers into the variables scope:
 * <p>
 * - newBuffer() : Create and return a new StringBuffer
 * - newBuilder() : Create and return a new StringBuilder
 * - processBody( context, body, [buffer] ) : Process the body of a component
 * - getName() : Get the name of the component
 */
@BoxComponent( "Feed" )
@AllowsBody( false )
@RequiresBody( false )
class{

	/**
	 * --------------------------------------------------------------------------
	 * Injections
	 * --------------------------------------------------------------------------
	 */
	property name="moduleRecord";
	property name="boxRuntime";
	property name="functionService";
	property name="componentService";
	property name="interceptorService";
	property name="asyncService";
	property name="schedulerService";
	property name="datasourceService";
	property name="cacheService";
	property name="log";

	/**
	 * Does something amazing
	 *
	 * <pre>
	 * bx:exampleComponent{}
	 * </pre>
	 *
	 * @param context The context of the execution (IBoxContext)
	 * @param attributes The attributes of the component that were passed in
	 * @param body The body of the component (ComponentBody lambda) that you can pass to `processBody(context, body, [buffer])` for execution and buffer retreival
	 * @param executionState The execution state of the component. Each component get's one as an isolated state.
	 *
	 * @return A BodyResult instance or null for a default result return.
	 */
	function invoke( required context, Struct attributes, any body, Struct executionState ){
		// A buffer to capture the body output
		var	buffer		= newBuffer();
		// Process the body lambda internally, calls all sub-components and get's output into the buffer
		var	bodyResult	= processBody( context, body, buffer );

		// If there was a return statement inside our body, we early exit now
		if ( bodyResult.isEarlyExit() ) {
			return bodyResult;
		}

		// SILLY Example: Reverse the content
		// reverse the buffer contents and place into a string
		var newContent	= buffer.toString();
		// output it to the page buffer
		context.writeToBuffer( newContent );
	}

}